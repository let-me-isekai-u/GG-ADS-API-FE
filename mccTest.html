<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Ads API - Nhập MCC và tạo Sub-account</title>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    form {
      display: block;
      max-width: 500px;
      margin: 0 auto;
    }
    form label {
      display: block;
      margin-bottom: 10px;
    }
    form input, form select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .button-container {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    button {
      width: 48%;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .button-container button:nth-child(2) {
      background-color: #f44336;
    }
    .button-container button:nth-child(2):hover {
      background-color: #e53935;
    }
    .message {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    .modal-content h3 {
      margin-bottom: 20px;
    }
    .modal-buttons {
      display: flex;
      justify-content: space-between;
    }
    .modal-buttons button {
      width: 48%;
    }
    .view-list-button {
      display: block;
      margin: 20px auto;
      padding: 10px;
      width: 200px;
      background-color: #2196F3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    .view-list-button:hover {
      background-color: #1976D2;
    }
  </style>
</head>
<body>
  <h2 style="text-align: center;">Nhập MCC và tạo Sub-account</h2>
  <form id="mccForm">
    <label for="managerAccountId">Mã tài khoản quản lý (MCC):
      <input type="text" id="managerAccountId" name="managerAccountId" value="6573029807" required>
    </label>
    
    <label for="accountName">Tên tài khoản:
      <input type="text" id="accountName" name="accountName" value="test" required>
    </label>
    
    <label for="currencyCode">Tiền tệ (VD: VND, USD):
      <select id="currencyCode" name="currencyCode" required></select>
    </label>
    
    <label for="timeZone">Múi giờ (VD: Asia/Ho_Chi_Minh):
      <select id="timeZone" name="timeZone" required></select>
    </label>
    
    <label for="numberOfAccount">Số lượng tài khoản con:
      <input type="number" id="numberOfAccount" name="numberOfAccount" value="2" min="1" required>
    </label>

    <div class="button-container">
      <button type="button" id="saveButton">Lưu</button>
      <button type="submit">Chạy</button>
    </div>
  </form>

  <button class="view-list-button" onclick="window.location.href='list-accounts.html'">Xem danh sách</button>

  <div id="result" class="message"></div>

  <!-- Modal chạy thành công -->
  <div class="modal" id="successModal">
    <div class="modal-content">
      <h3>Chạy thành công!</h3>
      <div class="modal-buttons">
        <button id="confirmBtn">Xác nhận</button>
        <button onclick="window.location.href='list-accounts.html'">Xem danh sách</button>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>
  <script>
    window.onload = async function () {
      const timeZoneSelect = document.getElementById('timeZone');
      const currencySelect = document.getElementById('currencyCode');

      // Load múi giờ
      try {
        const timeZones = moment.tz.names();
        if (!timeZones || timeZones.length === 0) throw new Error('Không có múi giờ nào được tải');

        timeZones.forEach(zone => {
          const offset = moment.tz(zone).format('Z'); // Lấy offset múi giờ (vd: +07:00)
          const option = document.createElement('option');
          option.value = zone;
          option.textContent = `${offset} (${zone})`;
          timeZoneSelect.appendChild(option);
        });
      } catch (err) {
        console.error('Lỗi khi tải múi giờ:', err);

        // Fallback: Sử dụng danh sách múi giờ mặc định
        const defaultTimeZones = [
          { zone: "Asia/Ho_Chi_Minh", offset: "+07:00" },
          { zone: "Asia/Bangkok", offset: "+07:00" },
          { zone: "Asia/Singapore", offset: "+08:00" },
          { zone: "Asia/Tokyo", offset: "+09:00" },
          { zone: "America/New_York", offset: "-04:00" },
          { zone: "Europe/London", offset: "+01:00" }
        ];

        defaultTimeZones.forEach(({ zone, offset }) => {
          const option = document.createElement('option');
          option.value = zone;
          option.textContent = `${offset} (${zone})`;
          timeZoneSelect.appendChild(option);
        });
      }

      // Load tiền tệ từ API JSON mở
      try {
        const res = await fetch('https://open.er-api.com/v6/latest/USD');
        if (!res.ok) throw new Error('API không phản hồi');
        const data = await res.json();
        const currencies = data.rates;

        Object.keys(currencies).forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = `${code}`;
          currencySelect.appendChild(option);
        });
      } catch (err) {
        console.error('Không thể tải danh sách tiền tệ, sử dụng danh sách mặc định:', err);
        const defaultCurrencies = ['USD', 'VND', 'EUR', 'GBP', 'JPY'];
        defaultCurrencies.forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = code;
          currencySelect.appendChild(option);
        });
      }

      $('#currencyCode').select2({ placeholder: 'Chọn tiền tệ', allowClear: true });
      $('#timeZone').select2({ placeholder: 'Chọn múi giờ', allowClear: true });
    };
  </script>
</body>
</html>